<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì •ì„œ 4ë¶„ë©´ ë§ˆìŒ í¸ì§€</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Pretendard', sans-serif;
        }
        .quadrant-selected {
            outline: 4px solid #3b82f6; /* blue-500 */
            outline-offset: -2px;
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.5);
        }
        @media print {
            body * { visibility: hidden; }
            #resultSection, #resultSection * { visibility: visible; }
            #resultSection { position: absolute; left: 0; top: 0; width: 100%; box-shadow: none !important; border: none !important; }
            .no-print { display: none !important; }
            #resultCard { -webkit-print-color-adjust: exact !important; color-adjust: exact !important; }
            
            .theme-rose #resultCard { background-color: #fff1f2 !important; } 
            .theme-rose #resultMainTitle { color: #f43f5e !important; } 
            .theme-rose #resultMainTitle .emphasized-name { color: #b45309 !important; } 

            .theme-forest #resultCard { background-color: #ecfdf5 !important; } 
            .theme-forest #resultMainTitle { color: #059669 !important; } 
            .theme-forest #resultMainTitle .emphasized-name { color: #0f766e !important; } 
            
            .theme-sunshine #resultCard { background-color: #fffbeb !important; } 
            .theme-sunshine #resultMainTitle { color: #f97316 !important; } 
            .theme-sunshine #resultMainTitle .emphasized-name { color: #f43f5e !important; } 

            #resultDate, #resultEmotion, #resultQuadrant, #resultAction, #resultLetter, #resultSection .label-text {
                color: #1f2937 !important; 
            }
            #resultSection .value-text {
                 color: #111827 !important; 
            }
        }
    </style>
</head>
<body class="bg-slate-100 text-gray-800 flex flex-col items-center min-h-screen p-4 sm:p-8">

    <div class="w-full max-w-2xl bg-white shadow-xl rounded-lg p-6 sm:p-10">
        <header class="mb-8 text-center">
            <h1 class="text-3xl sm:text-4xl font-bold text-sky-600">ì •ì„œ 4ë¶„ë©´ ë§ˆìŒ í¸ì§€</h1>
            <p class="text-gray-600 mt-2">ë‚˜ì˜ ê°ì •ì„ ëŒì•„ë³´ê³ , ë‚˜ì—ê²Œ ë”°ëœ»í•œ ë§ˆìŒì„ ì „í•´ë³´ì„¸ìš”.</p>
        </header>

        <section id="inputSection" class="space-y-6">
            <div>
                <label for="writerName" class="block text-lg font-semibold mb-2 text-gray-700">ì‘ì„±ì ì´ë¦„</label>
                <p class="text-sm text-gray-500 mb-2">ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>
                <input type="text" id="writerName" name="writer_name" class="w-full p-3 border border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-sky-500 focus:border-sky-500 transition" placeholder="ì˜ˆ: í™ê¸¸ë™">
            </div>

            <div>
                <label for="themeSelector" class="block text-lg font-semibold mb-2 text-gray-700">í¸ì§€ì§€ í…Œë§ˆ ì„ íƒ</label>
                <p class="text-sm text-gray-500 mb-2">ê²°ê³¼ ì¹´ë“œì˜ ë¶„ìœ„ê¸°ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.</p>
                <select id="themeSelector" name="theme" class="w-full p-3 border border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-sky-500 focus:border-sky-500 transition">
                    <option value="rose">í¬ê·¼í•œ ì¥ë¯¸ (ê¸°ë³¸)</option>
                    <option value="forest">ì°¨ë¶„í•œ ìˆ²</option>
                    <option value="sunshine">ë°œë„í•œ í–‡ì‚´</option>
                </select>
            </div>

            <div>
                <label for="emotionSelect" class="block text-lg font-semibold mb-2 text-gray-700">1. ì˜¤ëŠ˜ì˜ ê°ì •</label>
                <p class="text-sm text-gray-500 mb-2">ì§€ê¸ˆ ì–´ë–¤ ê°ì •ì„ ëŠë¼ê³  ìˆë‚˜ìš”? ëª©ë¡ì—ì„œ ì„ íƒí•˜ê±°ë‚˜ ì§ì ‘ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>
                <select id="emotionSelect" name="emotion" class="w-full p-3 border border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-sky-500 focus:border-sky-500 transition">
                    <option value="">-- ê°ì •ì„ ì„ íƒí•˜ì„¸ìš” --</option>
                    <option value="ê¸°ì¨">ê¸°ì¨ ğŸ˜Š</option>
                    <option value="ìŠ¬í””">ìŠ¬í”” ğŸ˜¢</option>
                    <option value="ë¶„ë…¸">ë¶„ë…¸ ğŸ˜ </option>
                    <option value="í‰ì˜¨">í‰ì˜¨ ğŸ˜Œ</option>
                    <option value="ë¶ˆì•ˆ">ë¶ˆì•ˆ ğŸ˜Ÿ</option>
                    <option value="ì‹ ë‚¨">ì‹ ë‚¨ ğŸ¥³</option>
                    <option value="ì‹¤ë§">ì‹¤ë§ ğŸ˜</option>
                    <option value="ìì‹ ê°">ìì‹ ê° ğŸ˜</option>
                    <option value="ê°ì‚¬">ê°ì‚¬ ğŸ™</option>
                    <option value="ê¸°íƒ€">ê¸°íƒ€ (ì§ì ‘ ì…ë ¥)</option>
                </select>
                <input type="text" id="emotionCustom" name="emotion_custom" class="w-full p-3 border border-gray-300 rounded-md shadow-sm mt-2 hidden focus:ring-2 focus:ring-sky-500 focus:border-sky-500 transition" placeholder="ê°ì •ì„ ì§ì ‘ ì…ë ¥í•˜ì„¸ìš”">
            </div>

            <div>
                <h2 class="block text-lg font-semibold mb-2 text-gray-700">2. ê°ì • 4ë¶„ë©´ ì„ íƒ</h2>
                <p class="text-sm text-gray-500 mb-3">ì„ íƒí•œ ê°ì •ì€ ì–´ë–¤ ì—ë„ˆì§€ì™€ ë°©í–¥ì„ ê°€ì§€ê³  ìˆë‚˜ìš”? í•´ë‹¹í•˜ëŠ” ì˜ì—­ì„ í´ë¦­í•˜ì„¸ìš”.</p>
                <div class="grid grid-cols-2 gap-2 sm:gap-4" id="emotionQuadrant">
                    <div data-quadrant="ë†’ì€ ì—ë„ˆì§€ & ê¸ì •ì  ê°ì •" class="quadrant-item h-28 sm:h-32 flex flex-col items-center justify-center text-center p-3 bg-orange-200 rounded-lg cursor-pointer hover:bg-orange-300 transition">
                        <span class="font-semibold text-orange-800">ë†’ì€ ì—ë„ˆì§€ & ê¸ì •</span><span class="text-xs text-orange-700 mt-1">(ì˜ˆ: ì‹ ë‚¨, ê¸°ì¨)</span>
                    </div>
                    <div data-quadrant="ë†’ì€ ì—ë„ˆì§€ & ë¶€ì •ì  ê°ì •" class="quadrant-item h-28 sm:h-32 flex flex-col items-center justify-center text-center p-3 bg-red-200 rounded-lg cursor-pointer hover:bg-red-300 transition">
                        <span class="font-semibold text-red-800">ë†’ì€ ì—ë„ˆì§€ & ë¶€ì •</span><span class="text-xs text-red-700 mt-1">(ì˜ˆ: ë¶„ë…¸, ë¶ˆì•ˆ)</span>
                    </div>
                    <div data-quadrant="ë‚®ì€ ì—ë„ˆì§€ & ê¸ì •ì  ê°ì •" class="quadrant-item h-28 sm:h-32 flex flex-col items-center justify-center text-center p-3 bg-green-200 rounded-lg cursor-pointer hover:bg-green-300 transition">
                        <span class="font-semibold text-green-800">ë‚®ì€ ì—ë„ˆì§€ & ê¸ì •</span><span class="text-xs text-green-700 mt-1">(ì˜ˆ: í‰ì˜¨, ë§Œì¡±)</span>
                    </div>
                    <div data-quadrant="ë‚®ì€ ì—ë„ˆì§€ & ë¶€ì •ì  ê°ì •" class="quadrant-item h-28 sm:h-32 flex flex-col items-center justify-center text-center p-3 bg-blue-200 rounded-lg cursor-pointer hover:bg-blue-300 transition">
                        <span class="font-semibold text-blue-800">ë‚®ì€ ì—ë„ˆì§€ & ë¶€ì •</span><span class="text-xs text-blue-700 mt-1">(ì˜ˆ: ìŠ¬í””, ë¬´ê¸°ë ¥)</span>
                    </div>
                </div>
                <input type="hidden" id="selectedQuadrant" name="selected_quadrant">
            </div>

            <div>
                <label for="positiveAction" class="block text-lg font-semibold mb-2 text-gray-700">3. ê¸ì •ì  í–‰ë™ ì „ëµ</label>
                <p class="text-sm text-gray-500 mb-2">ì´ ê°ì •ì„ ë” ê¸ì •ì ìœ¼ë¡œ ë§Œë“¤ê¸° ìœ„í•´ ì§€ê¸ˆ ë‹¹ì¥ í•  ìˆ˜ ìˆëŠ” í•œ ê°€ì§€ í–‰ë™ì€ ë¬´ì—‡ì¸ê°€ìš”?</p>
                <input type="text" id="positiveAction" name="positive_action" class="w-full p-3 border border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-sky-500 focus:border-sky-500 transition" placeholder="ì˜ˆ: ì¢‹ì•„í•˜ëŠ” ìŒì•… ë“£ê¸°">
            </div>

            <div>
                <label for="mindLetter" class="block text-lg font-semibold mb-2 text-gray-700">4. ë‚˜ì—ê²Œ ë³´ë‚´ëŠ” ë§ˆìŒ í¸ì§€</label>
                <p class="text-sm text-gray-500 mb-2">ì˜¤ëŠ˜ í•˜ë£¨ ìˆ˜ê³ í•œ ë‚˜ì—ê²Œ ì§§ì€ í¸ì§€ë¥¼ ì¨ì£¼ì„¸ìš”. (50~100ì ë‚´ì™¸ ê¶Œì¥)</p>
                <textarea id="mindLetter" name="mind_letter" rows="4" class="w-full p-3 border border-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-sky-500 focus:border-sky-500 transition" placeholder="ì˜ˆ: ì˜¤ëŠ˜ë„ ì •ë§ ìˆ˜ê³ í–ˆì–´!"></textarea>
            </div>

            <button id="showResultBtn" class="w-full bg-sky-600 hover:bg-sky-700 text-white font-bold py-3 px-4 rounded-md shadow-md transition duration-150 ease-in-out focus:outline-none focus:ring-2 focus:ring-sky-500 focus:ring-offset-2 no-print">
                ê²°ê³¼ ë³´ê¸°
            </button>
        </section>

        <section id="resultSection" class="mt-10 pt-8 border-t-2 hidden">
            <div id="resultCard" class="p-6 sm:p-8 rounded-xl shadow-2xl space-y-5 border"> 
                <div class="text-center mb-8">
                    <h2 id="resultMainTitle" class="text-2xl sm:text-3xl font-semibold mb-2"></h2>
                    <p id="resultDate" class="text-sm text-gray-500"></p>
                </div>
                <div>
                    <p class="font-semibold text-gray-700 flex items-center label-text"><span class="text-xl mr-2">ğŸ˜Š</span> ì˜¤ëŠ˜ì˜ ê°ì •:</p>
                    <p id="resultEmotion" class="value-text text-gray-800 ml-8 mt-1 p-2 bg-white/70 rounded"></p>
                </div>
                <div>
                    <p class="font-semibold text-gray-700 flex items-center label-text"><span class="text-xl mr-2">ğŸ¨</span> ì„ íƒí•œ 4ë¶„ë©´:</p>
                    <p id="resultQuadrant" class="value-text text-gray-800 ml-8 mt-1 p-2 bg-white/70 rounded"></p>
                </div>
                <div>
                    <p class="font-semibold text-gray-700 flex items-center label-text"><span class="text-xl mr-2">ğŸ’¡</span> ë‚˜ì˜ í–‰ë™ ì „ëµ:</p>
                    <p id="resultAction" class="value-text text-gray-800 ml-8 mt-1 p-2 bg-white/70 rounded"></p>
                </div>
                <div>
                    <p class="font-semibold text-gray-700 flex items-center label-text"><span class="text-xl mr-2">ğŸ’Œ</span> ë‚˜ì—ê²Œ ë³´ë‚´ëŠ” ë§ˆìŒ í¸ì§€:</p>
                    <p id="resultLetter" class="value-text text-gray-800 ml-8 mt-1 p-2 bg-white/70 rounded whitespace-pre-wrap"></p>
                </div>
            </div>

            <div id="resultActions" class="mt-8 text-center space-y-3 sm:space-y-0 sm:space-x-4 no-print">
                <button id="printBtn" class="w-full sm:w-auto bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-md shadow-md transition">
                    ì¸ì‡„ ë˜ëŠ” PDFë¡œ ì €ì¥
                </button>
                <button id="resetBtn" class="w-full sm:w-auto bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-md shadow-md transition">
                    ì²˜ìŒë¶€í„° ë‹¤ì‹œ í•˜ê¸°
                </button>
                <button id="createShareLinkBtn" class="w-full sm:w-auto bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-md shadow-md transition mt-3 sm:mt-0">
                    ê³µìœ  ë§í¬ ë§Œë“¤ê¸°
                </button>
            </div>
            <div id="shareLinkContainer" class="mt-4 hidden no-print">
                <label for="shareableLink" class="block text-sm font-medium text-gray-700 mb-1">ê³µìœ  ë§í¬:</label>
                <div class="flex space-x-2">
                    <input type="text" id="shareableLink" readonly class="w-full p-2 border border-gray-300 rounded-md shadow-sm bg-gray-100">
                    <button id="copyLinkBtn" class="bg-sky-500 hover:bg-sky-600 text-white font-semibold py-2 px-4 rounded-md shadow-sm transition">ë³µì‚¬</button>
                </div>
                <p id="copyFeedback" class="text-sm text-green-600 mt-1 hidden">ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!</p>
            </div>
            <p class="text-sm text-gray-500 mt-4 text-center no-print">Tip: ì¸ì‡„ ì°½ì—ì„œ 'ëŒ€ìƒ'ì„ 'PDFë¡œ ì €ì¥'ìœ¼ë¡œ ì„ íƒí•˜ë©´ íŒŒì¼ë¡œ ì €ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
        </section>

        <footer class="mt-12 text-center text-sm text-gray-500 no-print">
            <p>&copy; <span id="currentYear"></span> ë§ˆìŒ í¸ì§€ ì›¹ í•™ìŠµì§€.</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const writerNameInput = document.getElementById('writerName');
            const themeSelector = document.getElementById('themeSelector');
            const emotionSelect = document.getElementById('emotionSelect');
            const emotionCustom = document.getElementById('emotionCustom');
            const quadrantItems = document.querySelectorAll('.quadrant-item');
            const selectedQuadrantInput = document.getElementById('selectedQuadrant');
            const positiveActionInput = document.getElementById('positiveAction');
            const mindLetterInput = document.getElementById('mindLetter');

            const showResultBtn = document.getElementById('showResultBtn');
            const resultSection = document.getElementById('resultSection');
            const resultCard = document.getElementById('resultCard');
            const printBtn = document.getElementById('printBtn');
            const resetBtn = document.getElementById('resetBtn');
            const createShareLinkBtn = document.getElementById('createShareLinkBtn');
            const shareLinkContainer = document.getElementById('shareLinkContainer');
            const shareableLinkInput = document.getElementById('shareableLink');
            const copyLinkBtn = document.getElementById('copyLinkBtn');
            const copyFeedback = document.getElementById('copyFeedback');
            
            const resultMainTitle = document.getElementById('resultMainTitle');
            const resultDateEl = document.getElementById('resultDate');
            const resultEmotion = document.getElementById('resultEmotion');
            const resultQuadrant = document.getElementById('resultQuadrant');
            const resultAction = document.getElementById('resultAction');
            const resultLetter = document.getElementById('resultLetter');
            
            document.getElementById('currentYear').textContent = new Date().getFullYear();

            const themes = {
                'rose': { cardBg: 'bg-rose-50', cardBorder: 'border-rose-200', titleColor: 'text-rose-500', nameEmphasisColor: 'text-amber-700', printClass: 'theme-rose' },
                'forest': { cardBg: 'bg-emerald-50', cardBorder: 'border-emerald-200', titleColor: 'text-emerald-600', nameEmphasisColor: 'text-teal-700', printClass: 'theme-forest' },
                'sunshine': { cardBg: 'bg-amber-50', cardBorder: 'border-amber-200', titleColor: 'text-orange-500', nameEmphasisColor: 'text-rose-600', printClass: 'theme-sunshine' }
            };
            let currentThemeClasses = {};
            let lastGeneratedData = null; // ë§ˆì§€ë§‰ìœ¼ë¡œ ìƒì„±ëœ ê²°ê³¼ ë°ì´í„° ì €ì¥ìš©

            function applyTheme(themeKey, data = {}) {
                const theme = themes[themeKey] || themes.rose; // themeKeyê°€ ì—†ìœ¼ë©´ ê¸°ë³¸ê°’ìœ¼ë¡œ rose

                if (currentThemeClasses.cardBg) resultCard.classList.remove(currentThemeClasses.cardBg);
                if (currentThemeClasses.cardBorder) resultCard.classList.remove(currentThemeClasses.cardBorder);
                if (currentThemeClasses.titleColor) resultMainTitle.classList.remove(currentThemeClasses.titleColor);
                if (currentThemeClasses.printClass) resultSection.classList.remove(currentThemeClasses.printClass);

                resultCard.classList.add(theme.cardBg, theme.cardBorder);
                resultMainTitle.classList.add(theme.titleColor);
                resultSection.classList.add(theme.printClass); 

                currentThemeClasses = { cardBg: theme.cardBg, cardBorder: theme.cardBorder, titleColor: theme.titleColor, printClass: theme.printClass };
                
                // ì œëª© ë° ë‚ ì§œ ì„¤ì • (ë°ì´í„°ê°€ ìˆì„ ê²½ìš°)
                const nameToDisplay = data.writerName || writerNameInput.value.trim();
                const dateToDisplay = data.date || `${new Date().getFullYear()}ë…„ ${String(new Date().getMonth() + 1).padStart(2, '0')}ì›” ${String(new Date().getDate()).padStart(2, '0')}ì¼`;

                if (nameToDisplay) {
                    resultMainTitle.innerHTML = `ì˜¤ëŠ˜, <span class="font-bold ${theme.nameEmphasisColor} emphasized-name">${nameToDisplay}</span>ë‹˜ì˜ ë§ˆìŒ ì´ì•¼ê¸° âœ¨`;
                } else {
                     resultMainTitle.innerHTML = ''; // ì´ë¦„ ì—†ìœ¼ë©´ ë¹„ì›€
                }
                resultDateEl.textContent = dateToDisplay;
                
                // ê²°ê³¼ ì„¹ì…˜ ìƒë‹¨ í…Œë‘ë¦¬ ìƒ‰ìƒ ë™ì  ì ìš©
                resultSection.classList.remove('border-sky-100', 'border-rose-200', 'border-emerald-200', 'border-amber-200', 'border-t-rose-200', 'border-t-emerald-200', 'border-t-amber-200');
                resultSection.classList.add(theme.cardBorder.replace('border-', 'border-t-'));
                
                return theme;
            }
            
            function populateResults(data) {
                resultEmotion.textContent = data.emotion;
                resultQuadrant.textContent = data.quadrant;
                resultAction.textContent = data.action;
                resultLetter.textContent = data.letter;
            }

            function loadFromURL() {
                const params = new URLSearchParams(window.location.search);
                if (params.has('name') && params.has('emotion')) { // ì£¼ìš” íŒŒë¼ë¯¸í„° ì¡´ì¬ ì—¬ë¶€ë¡œ ê³µìœ  ëª¨ë“œ íŒë‹¨
                    const sharedData = {
                        writerName: decodeURIComponent(params.get('name')),
                        theme: params.get('theme') || 'rose',
                        emotion: decodeURIComponent(params.get('emotion')),
                        quadrant: decodeURIComponent(params.get('quadrant')),
                        action: decodeURIComponent(params.get('action')),
                        letter: decodeURIComponent(params.get('letter')),
                        date: decodeURIComponent(params.get('date'))
                    };

                    applyTheme(sharedData.theme, sharedData); // ì´ë¦„, ë‚ ì§œëŠ” applyTheme ë‚´ì—ì„œ ì²˜ë¦¬
                    populateResults(sharedData);

                    document.getElementById('inputSection').classList.add('hidden');
                    showResultBtn.classList.add('hidden');
                    resetBtn.classList.add('hidden'); // ê³µìœ  ëª¨ë“œì—ì„œ ì´ˆê¸°í™” ë²„íŠ¼ ìˆ¨ê¹€
                    createShareLinkBtn.classList.add('hidden'); // ê³µìœ  ëª¨ë“œì—ì„œ ë§í¬ ìƒì„± ë²„íŠ¼ ìˆ¨ê¹€
                    shareLinkContainer.classList.add('hidden');

                    resultSection.classList.remove('hidden');
                    resultSection.scrollIntoView({ behavior: 'auto' });
                    return true; // ê³µìœ  ëª¨ë“œë¡œ ë¡œë“œë¨
                }
                return false; // ì¼ë°˜ ëª¨ë“œë¡œ ë¡œë“œë¨
            }

            if (!loadFromURL()) {
                // ì¼ë°˜ ëª¨ë“œì¼ ë•Œë§Œ ì´ˆê¸° í…Œë§ˆ ì ìš©
                applyTheme(themeSelector.value);
            }

            emotionSelect.addEventListener('change', function() {
                emotionCustom.classList.toggle('hidden', this.value !== 'ê¸°íƒ€');
                if (this.value === 'ê¸°íƒ€') emotionCustom.focus(); else emotionCustom.value = '';
            });

            let currentSelectedQuadrant = null;
            quadrantItems.forEach(item => {
                item.addEventListener('click', function() {
                    if (currentSelectedQuadrant) {
                        currentSelectedQuadrant.classList.remove('quadrant-selected');
                        currentSelectedQuadrant.classList.add('hover:bg-' + getBaseColor(currentSelectedQuadrant) + '-300');
                    }
                    this.classList.add('quadrant-selected');
                    this.classList.remove('hover:bg-' + getBaseColor(this) + '-300');
                    currentSelectedQuadrant = this;
                    selectedQuadrantInput.value = this.dataset.quadrant;
                });
            });

            function getBaseColor(element) { /* ... ì´ì „ê³¼ ë™ì¼ ... */ 
                const classList = element.classList;
                if (classList.contains('bg-orange-200')) return 'orange';
                if (classList.contains('bg-red-200')) return 'red';
                if (classList.contains('bg-green-200')) return 'green';
                if (classList.contains('bg-blue-200')) return 'blue';
                return 'gray';
            }

            showResultBtn.addEventListener('click', function() {
                const writerNameValue = writerNameInput.value.trim();
                if (!writerNameValue) { alert("ì‘ì„±ì ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”."); writerNameInput.focus(); return; }

                let emotionValue = emotionSelect.value;
                if (emotionValue === 'ê¸°íƒ€') emotionValue = emotionCustom.value.trim() || "ê¸°íƒ€ (ì…ë ¥ ì—†ìŒ)";
                else if (!emotionValue) { alert("ì˜¤ëŠ˜ì˜ ê°ì •ì„ ì„ íƒí•˜ê±°ë‚˜ ì…ë ¥í•´ì£¼ì„¸ìš”."); emotionSelect.focus(); return; }

                const quadrantValue = selectedQuadrantInput.value;
                if (!quadrantValue) { alert("ê°ì • 4ë¶„ë©´ì„ ì„ íƒí•´ì£¼ì„¸ìš”."); document.getElementById('emotionQuadrant').scrollIntoView({ behavior: 'smooth', block: 'center' }); return; }

                const actionValue = positiveActionInput.value.trim();
                if (!actionValue) { alert("ê¸ì •ì  í–‰ë™ ì „ëµì„ ì…ë ¥í•´ì£¼ì„¸ìš”."); positiveActionInput.focus(); return; }
                
                const letterValue = mindLetterInput.value.trim();
                if (!letterValue) { alert("ë‚˜ì—ê²Œ ë³´ë‚´ëŠ” ë§ˆìŒ í¸ì§€ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”."); mindLetterInput.focus(); return; }
                
                const today = new Date();
                const formattedDate = `${today.getFullYear()}ë…„ ${String(today.getMonth() + 1).padStart(2, '0')}ì›” ${String(today.getDate()).padStart(2, '0')}ì¼`;
                const selectedThemeKey = themeSelector.value;

                lastGeneratedData = { // ê³µìœ ìš© ë°ì´í„° ì €ì¥
                    writerName: writerNameValue,
                    theme: selectedThemeKey,
                    emotion: emotionValue,
                    quadrant: quadrantValue,
                    action: actionValue,
                    letter: letterValue,
                    date: formattedDate
                };
                
                applyTheme(selectedThemeKey, lastGeneratedData);
                populateResults(lastGeneratedData);
                
                resultSection.classList.remove('hidden');
                createShareLinkBtn.classList.remove('hidden'); // ê³µìœ  ë§í¬ ë§Œë“¤ê¸° ë²„íŠ¼ í‘œì‹œ
                shareLinkContainer.classList.add('hidden'); // ë§í¬ í‘œì‹œëŠ” ì¼ë‹¨ ìˆ¨ê¹€
                copyFeedback.classList.add('hidden');
                resetBtn.classList.remove('hidden'); // ì´ˆê¸°í™” ë²„íŠ¼ ë‹¤ì‹œ í‘œì‹œ (ê³µìœ ëª¨ë“œì—ì„œ ìˆ¨ê²¨ì¡Œì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ)
                resultSection.scrollIntoView({ behavior: 'smooth' });
            });

            createShareLinkBtn.addEventListener('click', function() {
                if (!lastGeneratedData) {
                    alert("ë¨¼ì € ê²°ê³¼ë¥¼ ìƒì„±í•´ì£¼ì„¸ìš”.");
                    return;
                }
                const params = new URLSearchParams();
                params.append('name', encodeURIComponent(lastGeneratedData.writerName));
                params.append('theme', encodeURIComponent(lastGeneratedData.theme));
                params.append('emotion', encodeURIComponent(lastGeneratedData.emotion));
                params.append('quadrant', encodeURIComponent(lastGeneratedData.quadrant));
                params.append('action', encodeURIComponent(lastGeneratedData.action));
                params.append('letter', encodeURIComponent(lastGeneratedData.letter));
                params.append('date', encodeURIComponent(lastGeneratedData.date));

                const baseUrl = window.location.origin + window.location.pathname;
                const shareUrl = `${baseUrl}?${params.toString()}`;
                
                shareableLinkInput.value = shareUrl;
                shareLinkContainer.classList.remove('hidden');
            });

            copyLinkBtn.addEventListener('click', function() {
                shareableLinkInput.select(); // ëª¨ë°”ì¼ì—ì„œ ë³µì‚¬ ìš©ì´ì„±ì„ ìœ„í•´ ì„ íƒ
                try {
                    navigator.clipboard.writeText(shareableLinkInput.value)
                        .then(() => {
                            copyFeedback.textContent = "ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!";
                            copyFeedback.classList.remove('hidden');
                            setTimeout(() => copyFeedback.classList.add('hidden'), 2000);
                        })
                        .catch(err => {
                            copyFeedback.textContent = "ë³µì‚¬ ì‹¤íŒ¨. ì§ì ‘ ë³µì‚¬í•´ì£¼ì„¸ìš”.";
                            copyFeedback.classList.remove('hidden');
                            console.error('Copy failed: ', err);
                        });
                } catch (err) {
                     // navigator.clipboardê°€ ì—†ëŠ” ê²½ìš° (ì˜ˆ: http í™˜ê²½, ì˜¤ë˜ëœ ë¸Œë¼ìš°ì €)
                    copyFeedback.textContent = "ë³µì‚¬ ê¸°ëŠ¥ì´ ì§€ì›ë˜ì§€ ì•ŠëŠ” í™˜ê²½ì…ë‹ˆë‹¤. ì§ì ‘ ì„ íƒí•˜ì—¬ ë³µì‚¬í•´ì£¼ì„¸ìš”.";
                    copyFeedback.classList.remove('hidden');
                    console.error('Clipboard API not available: ', err);
                }
            });

            printBtn.addEventListener('click', () => window.print());

            resetBtn.addEventListener('click', function() {
                writerNameInput.value = '';
                themeSelector.value = 'rose'; 
                applyTheme('rose'); 
                emotionSelect.value = '';
                emotionCustom.value = '';
                emotionCustom.classList.add('hidden');
                if (currentSelectedQuadrant) { /* ... */ } // ì´ì „ê³¼ ë™ì¼
                selectedQuadrantInput.value = '';
                positiveActionInput.value = '';
                mindLetterInput.value = '';
                
                resultMainTitle.innerHTML = ''; 
                resultDateEl.textContent = '';
                resultSection.classList.add('hidden');
                createShareLinkBtn.classList.add('hidden');
                shareLinkContainer.classList.add('hidden');
                copyFeedback.classList.add('hidden');
                lastGeneratedData = null;

                // URLì—ì„œ íŒŒë¼ë¯¸í„° ì œê±°í•˜ê³  ìƒˆë¡œê³ ì¹¨ (ì„ íƒì : ì¼ë°˜ ëª¨ë“œë¡œ í™•ì‹¤íˆ ëŒì•„ê°€ê¸°)
                if (window.location.search) {
                     window.location.href = window.location.pathname;
                } else {
                    writerNameInput.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            });
        });
    </script>
</body>
</html>
